<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Test Countdown 10s + Fireworks</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0; font-family:sans-serif; background:#0a0a2a; color:#fff; text-align:center; overflow:hidden;}
#startScreen{position:fixed; inset:0; display:flex; justify-content:center; align-items:center; font-size:36px; font-weight:bold; cursor:pointer; background:#0a0a2a; z-index:10;}
canvas{position:fixed; inset:0; z-index:1;}
#letter{position:fixed; inset:0; display:flex; justify-content:center; align-items:center; background:rgba(0,0,0,0.5); opacity:0; pointer-events:none; transition:1s; z-index:20;}
#letter.show{opacity:1; pointer-events:auto;}
.letter-paper{background:#fff; padding:30px; border-radius:16px; max-width:400px; color:#333; text-align:left;}
#letterImage{width:100%; margin-top:15px; border-radius:12px;}
footer{margin-top:50px; font-size:22px; opacity:0; transition:2s;}
footer.show{opacity:1;}
</style>
</head>
<body>

<div id="startScreen">BẮT ĐẦU</div>
<canvas id="fireworks"></canvas>

<div id="letter">
  <div class="letter-paper">
    <p><b>Chúc mừng năm mới!</b></p>
    <p>Năm mới vui vẻ, hạnh phúc và tràn đầy năng lượng nhé!</p>
    <img id="letterImage" src="newyear.jpg" alt="Ảnh kỷ niệm">
  </div>
</div>

<footer id="final">Chúc mừng năm mới!</footer>

<script>
const startScreen=document.getElementById("startScreen");
const letter=document.getElementById("letter");
const final=document.getElementById("final");
const canvas=document.getElementById("fireworks");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth; canvas.height=innerHeight;
window.onresize=()=>{canvas.width=innerWidth; canvas.height=innerHeight;}

let sparks=[];

function hexToRgb(hex){hex=hex.replace("#",""); const bigint=parseInt(hex,16); const r=(bigint>>16)&255; const g=(bigint>>8)&255; const b=bigint&255; return `${r},${g},${b}`;}

function launchFirework(){
    const x=Math.random()*canvas.width;
    const y=canvas.height;
    const colors=["#ff4d4d","#ffcc00","#33ff33","#33ccff","#ff33ff"];
    const color=colors[Math.floor(Math.random()*colors.length)];
    const count=30+Math.floor(Math.random()*20);
    for(let i=0;i<count;i++){
        const angle=Math.random()*2*Math.PI;
        const speed=2+Math.random()*4;
        sparks.push({x:x, y:y, vx:Math.cos(angle)*speed, vy:Math.sin(angle)*speed-(5+Math.random()*5), life:80+Math.random()*40, alpha:1, color:color, size:2+Math.random()*2});
    }
}

function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let i=sparks.length-1;i>=0;i--){
        const s=sparks[i]; s.x+=s.vx; s.y+=s.vy; s.alpha-=0.02; s.life--;
        if(s.alpha<=0||s.life<=0){sparks.splice(i,1); continue;}
        ctx.fillStyle=`rgba(${hexToRgb(s.color)},${s.alpha})`;
        ctx.beginPath(); ctx.arc(s.x,s.y,s.size,0,2*Math.PI); ctx.fill();
    }
    requestAnimationFrame(animate);
}

function startCountdown(){
    let diff=10;
    const timer=setInterval(()=>{
        diff--;
        if(diff<=0){
            clearInterval(timer);
            // Hiển thị pháo hoa + thư + footer
            const fireworkInterval=setInterval(launchFirework,200);
            setTimeout(()=>{letter.classList.add("show"); final.classList.add("show"); clearInterval(fireworkInterval);},3000);
        }
    },1000);
    animate();
}

startScreen.onclick=()=>{startScreen.style.display="none"; startCountdown();}
</script>

</body>
</html>
